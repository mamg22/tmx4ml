{% extends "ui.xml" %}
{% set origin = request.url.origin() %}
{% set quoted_name = '"{}"'.format(user.Name) %}

{% set sidebar_buttons = {
0: ("Icons128x128_1:Challenge", "Tracks", "manialink:{}{}".format(origin, url("track-list").with_query(query='authoruserid:' ~ user.UserId))),
1: ("Icons128x128_1:Browse", "Trackpacks", "manialink:{}{}".format(origin, url("trackpack-list").with_query(query='creator:' ~ quoted_name))),
2: ("Icons128x32_1:RT_Cup", "Awards Received", "manialink:{}{}".format(origin, url("track-list").with_query(
    query='order1:awardsdesc author:' ~ quoted_name))),
3: ("Icons64x64_1:StateSuggested", "Awards Given", "manialink:{}{}".format(origin, url("track-list").with_query(
    query='order1:userawardeddesc awardedby:' ~ quoted_name))),
4: ("Icons64x64_1:Inbox", "Comments Received", "manialink:{}{}".format(origin, url("track-list").with_query(
    query='order1:commentsdesc author:' ~ quoted_name))),
5: ("Icons64x64_1:Outbox", "Comments Given", "manialink:{}{}".format(origin, url("track-list").with_query(
    query='order1:usercommenteddesc commentedby:' ~ quoted_name))),
8: ("Icons64x64_1:Windowed", "Open in browser", "url:{}/usershow/{}".format(app["base_url"], user.UserId)),
} %}

{% set subtitle = "User details" %}


{% block body %}
    {% call(width, height) titled_box("Profile", BODY_LEFT + 2, 40, 50, 14) %}
    <label text="{{ user.Name }}" posn="0 0 3" sizen="{{ width }}" textsize="3"/>

    <label text="ID #" style="TextStaticSmall" posn="{{ width - 7 }} {{ -height }}" halign="right" valign="bottom"/>
    <entry default="{{ user.UserId }}" posn="{{ width }} {{ -height }} 3" halign="right" valign="bottom" sizen="7" style="TextStaticSmall"/>
    {% endcall %}
    {% call(width, height) titled_box("User comments", BODY_LEFT + 2, 24, 50, 70) %}
        {% set comment_style = "TextStaticSmall" if user.UserComments else "" %}
        <label text="{{ user.UserComments | format_bbcode | default('$i$bbb(No text defined)', true) | safe }}"
        style="TextStaticSmall" sizen="{{ width }} {{ height }}" posn="0 0 4" autonewline="1" maxline="20"/>
    {% endcall %}
    {% call(width, height) titled_box("Statistics", BODY_LEFT + 54, 40, 42, 39) %}
    {% for field, value in {
        "Tracks": user.Tracks,
        "Track Packs": user.TrackPacks,
        "Awards Received": user.TrackAwardsReceived,
        "Awards Given": user.TrackAwardsGiven,
        "Comments Received": user.TrackCommentsReceived,
        "Comments Given": user.TrackCommentsGiven,
        "Favorites": user.Favorites,
        "Achievements": user.Achievements,
    }.items() %}
        <frame posn="0 {{ -4 * loop.index0 }}">
            <label style="TextStaticSmall" text="{{ field }}" posn="0 0 5"/>
            <label style="TextStaticSmall" text="{{ value }}" posn="{{ width }} 0 4" halign="right"/>
        </frame>
    {% endfor %}
    {% endcall %}
    {% call(width, height) titled_box("Replays ({})".format(user.Replays), BODY_LEFT + 54, 0, 42, 21) %}
    {% for medal in ( "Author", "Gold", "Silver", "Bronze" ) %}
        {% set style = medal if medal != "Author" else "Nadeo" %}
        {% set prev_count = user[loop.previtem + 'Medals'] if not loop.first else 0 %}
        {% set medal_count = user[medal + 'Medals'] - prev_count %}

        <quad style="MedalsBig" substyle="Medal{{ style }}" posn="{{ 1 + 10 * loop.index0}} 0 6" sizen="6 7" />
        <label style="TextStaticSmall" text="{{ medal_count }}"
            posn="{{ 4 + 10 * loop.index0 }} -8 5" halign="center" sizen="6 2"/>
        <label style="TextStaticSmall" text="{{ '{:.1%}'.format(medal_count / user.Replays) if user.Replays > 0 }}"
            posn="{{ 4 + 10 * loop.index0 }} -11 5" halign="center" sizen="6 2"/>
    {% endfor %}
    {% endcall %}
{% endblock body %}
